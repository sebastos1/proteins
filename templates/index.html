<% include!("./header.html"); %>
  <body class="indexbody">
    <div class="mayn">
        <div class="tablecontainer">
            <div class="buttons">
                <form action="/custom">
                    <input type="submit" value="Add product" />
                </form>
                <form action="/paper">
                    <input type="submit" value="Custom list" />
                </form>
                <form action="/search" class="searchbutton">
                    <input type="text" name="search" value="" placeholder="Search">
                    <input type="hidden" name="id" value="<%= rng %>">
                    <input type="submit" class="hiddensubmit">
                </form>
                <form action="/columns">
                    <input type="hidden" name="id" value="<%= rng %>">
                    <input type="submit" value="Edit columns">
                </form>
            </div>
            
            <% if show_column_settings { %>
                <div class="colticks">
                    <form action="column">
                        <input type="hidden" name="id" value="<%= rng %>">
                        <% for (nutrient_id, nutrient_map) in dictionary { %>
                            <b><%= nutrient_map["no"] %>:</b>
                            <input class="tick" type="checkbox" name="<%= nutrient_id %>"
                            <% if active_columns.contains(&nutrient_id.to_string()) { %>
                                value="1" checked
                            <% } %>
                            >
                        <% } %>
                        <input type="submit" value="Update">
                    </form>
                </div>
            <% } %>

            <% if currently_sorting_by != "" { %>
                <h3 class="sorttype">Sorting by: <%= currently_sorting_by%></h3>
            <% } else { %>
                <h3 class="sorttype">Not sorting</h3>
            <% } %>
            <table class="biglist">
                <thead>
                    <td></td>
                    <% for item in &active_columns { %>
                        <td>
                            <form action="/sort" >
                                <input type="hidden" name="sortby" value="<%= item %>">
                                <input type="hidden" name="id" value="<%= rng %>">
                                <input type="submit" value="<%= item %>" class="sortbutton">
                            </form>
                        </td>
                    <% } %>
                </thead>
        
                <% let end: usize; %>
                <% let entries_cursor = entries_cursor; %>
        
                <% if y.len() < entries_per_page { %>
                    <% end = y.len(); %>
                <% } else if entries_cursor >= y.len()-entries_per_page { %>
                    <% end = y.len(); %>
                <% } else { %>
                    <% end = entries_cursor + entries_per_page; %>
                <% } %>
        
                <% if y.is_empty() { %>
                    <p>No results.</p>
                <% } else { %>
                    <% for k in &y[entries_cursor..end] { %>
                            <td class="prodname"><a href="/product/<%= k %>"><%= k %></a></td>
                            <% for entry in &active_columns { %>
                                <% if food_data_map[k].contains_key(&entry.to_string()) && food_data_map[k][&entry.to_string()] != ""  { %>
                                    <td class="prodval"><%= food_data_map[k][&entry.to_string()] %></td>
                                <% } else { %>
                                    <td class="prodval"><%= "0" %></td>
                                <% } %>
                            <% } %>
                        </tr>
                    <% } %>
                <% } %>
            </table>
            <div class="pagebuttons">
                <div class="prev">
                    <% if entries_cursor >= entries_per_page { %>
                        <form action="/change">
                            <input type="hidden" name="goto" value="down">
                            <input type="hidden" name="id" value="<%= rng %>">
                            <input type="submit" value="Prev page" class="submit">
                        </form>
                    <% } %>
                </div>
                <div class="foodcount">
                    <p><%= &y.len() %> results</p>
                    <p>Page <%= entries_cursor / entries_per_page + 1   %> / <%= y.len() / entries_per_page + 1 %></p>
                </div>
                <div class="next">
                    <% if y.len() > entries_per_page && entries_cursor < y.len()-entries_per_page { %>
                        <form action="/change" class="next">
                            <input type="hidden" name="goto" value="up">
                            <input type="hidden" name="id" value="<%= rng %>">
                            <input type="submit" value="Next page" class="submit">
                        </form>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <a href="/update/<%= rng %>" class="upd">Update</a>
  </body>
</html>
